<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Login | Dashboard Jasher</title>
  <link rel="stylesheet" href="style.css"/>
</head>
<body class="login-page">
  <div class="login-card">
    <h1>🔐 Jasher Bot</h1>
    <input id="username" type="text" placeholder="Username" autocomplete="username"/>
    <input id="password" type="password" placeholder="Password" autocomplete="current-password"/>
    <div class="row">
      <button id="loginBtn">Masuk</button>
      <button id="registerBtn" class="ghost">Daftar</button>
    </div>
    <p id="loginError" class="error"></p>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDz621OqT9ERxnyCY7BGmh3iMUnb97-TDI",
      authDomain: "database-d81c7.firebaseapp.com",
      projectId: "database-d81c7",
      storageBucket: "database-d81c7.appspot.com",
      messagingSenderId: "934049685295",
      appId: "1:934049685295:web:17ad6001402c57b9434bda"
    };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const usernameInput = document.getElementById("username");
    const passwordInput = document.getElementById("password");
    const loginBtn = document.getElementById("loginBtn");
    const registerBtn = document.getElementById("registerBtn");
    const loginError = document.getElementById("loginError");

    loginBtn.addEventListener("click", async () => {
      loginError.textContent = "";
      const username = usernameInput.value.trim();
      const password = passwordInput.value;
      if (!username || !password) return loginError.textContent = "Isi username & password.";
      const userDoc = await getDoc(doc(db, "users", username));
      if (!userDoc.exists() || userDoc.data().password !== password) {
        loginError.textContent = "❌ Username/password salah.";
        return;
      }
      localStorage.setItem("username", username);
      localStorage.setItem("role", userDoc.data().role || "user");
      window.location.href = "dashboard.html";
    });

    registerBtn.addEventListener("click", async () => {
      loginError.textContent = "";
      const username = usernameInput.value.trim();
      const password = passwordInput.value;
      if (!username || !password) return loginError.textContent = "Isi username & password.";
      const userDoc = await getDoc(doc(db, "users", username));
      if (userDoc.exists()) return loginError.textContent = "❌ Username sudah dipakai.";
      await setDoc(doc(db, "users", username), { password, role: "user" });
      alert("✅ Akun dibuat. Silahkan login.");
    });
  </script>
</body>
</html>